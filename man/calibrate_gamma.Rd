% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulation.r
\name{calibrate_gamma}
\alias{calibrate_gamma}
\title{Gamma Calibration for Target Type-I Error}
\usage{
calibrate_gamma(
  bcts_fun,
  type1 = 0.025,
  type1.tolerance = 0.001,
  nsim = 1000,
  gamma_scaling = 0.75,
  req_n_events = 10,
  max.iter = 10
)
}
\arguments{
\item{bcts_fun}{A function that simulates Bayesian clinical trials and computes results for a given gamma threshold.
It should return a list containing a \code{simresults} object with details such as \code{gamma}, \code{nsim}, and \code{rejectH0.final}.}

\item{type1}{The target Type-I error rate.}

\item{type1.tolerance}{The acceptable tolerance for the difference between the empirical and target Type-I error rate. Default is \code{0.001}.}

\item{nsim}{Number of trials to simulate (default: 1000)}

\item{gamma_scaling}{A numeric value used to scale or adjust the gamma parameter during the initial step of the Type-I error estimation process.
This factor is applied as an exponent to \code{1-gamma} in initial calculations.}

\item{req_n_events}{Initial number of required events for the simulation. This value is increased iteratively to ensure robust calibration. Default is \code{10}.}

\item{max.iter}{The maximum number of iterations allowed during the calibration process. Default is \code{10}.}
}
\value{
A list containing the following elements:
\itemize{
\item \strong{gamma.opt}: The calibrated gamma threshold for declaring success, optimized to approximate the target Type-I error.
\item \strong{sim.opt}: The simulation results for the final calibrated gamma threshold.
\item \strong{table}: A \code{data.frame} summarizing all tested gamma threshold values and their corresponding results:
\itemize{
\item \code{gamma}: The tested gamma threshold values.
\item \code{n.exp}: The expected number of events based on the tested gamma threshold.
\item \code{n.obs}: The observed number of events.
\item \code{n.total}: The total number of simulations.
\item \code{est}: The estimated Type-I error rate.
\item \code{lower}: The lower bound of the confidence interval for the Type-I error.
\item \code{upper}: The upper bound of the confidence interval for the Type-I error.
}
}
}
\description{
This function calibrates the gamma threshold in a Bayesian clinical trial simulation to achieve a specified target Type-I error rate.
It uses a binomial regression model to iteratively refine gamma, aiming for the closest match to the target Type-I error within a given tolerance.
}
\details{
The function begins by estimating the Type-I error for \code{(1-type1)} and \code{(1-type1)^gamma_scaling}.
It then fits a binomial regression model to predict the gamma threshold that achieves the target Type-I error.
During each iteration, the function:
\itemize{
\item Computes the empirical Type-I error for the predicted gamma threshold.
\item Updates the binomial regression model with the new results.
\item Refines the gamma threshold until the empirical Type-I error is within the specified tolerance or the maximum number of iterations is reached.
}

If the tolerance is not achieved within \code{max.iter} iterations, the function returns the best available estimate for the gamma threshold.
}
\note{
This function assumes that \code{bcts_fun} returns a list containing a \code{simresults} object with the following:
\itemize{
\item \code{gamma}: The gamma threshold value used in the simulation.
\item \code{nsim}: The number of simulations performed.
\item \code{rejectH0.final}: A vector indicating whether the null hypothesis was rejected in each simulation.
}

The binomial regression model is used to interpolate the optimal gamma threshold rather than relying solely on stepwise iteration, improving efficiency and precision.
}
\author{
Thomas Debray \email{tdebray@fromdatatowisdom.com}
}
