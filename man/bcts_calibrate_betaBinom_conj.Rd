% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/bayesNI-conj-calibrate.R
\name{bcts_calibrate_betaBinom_conj}
\alias{bcts_calibrate_betaBinom_conj}
\title{Calibrate the posterior threshold gamma (Beta–Binomial, conjugate)}
\usage{
bcts_calibrate_betaBinom_conj(
  alpha = 0.1,
  p_c,
  M,
  n_c,
  n_t,
  prior = c("flat", "power"),
  prior_args = list(),
  B_cal = 2000,
  lower = 0.8,
  upper = 0.999,
  n_draws = 2000,
  tol = 0.002,
  maxit = 30,
  seed = 11L,
  show_progress = FALSE,
  verbose = TRUE,
  digits = 4,
  progress_fun = NULL
)
}
\arguments{
\item{alpha}{Target Type-I error in \verb{(0,1)}, e.g., \code{0.10}.}

\item{p_c}{Control-arm response probability under the null (in \verb{[0,1]}).}

\item{M}{Margin on the risk-difference scale (negative for NI; nonnegative for superiority).}

\item{n_c, n_t}{Sample sizes in control and treatment (integers).}

\item{prior}{Either \code{"flat"} or \code{"power"}. See \code{prior_args}.}

\item{prior_args}{List for power prior on control:
\itemize{
\item \code{a0}, \code{y_0}, \code{n_0}, \code{a_base}, \code{b_base}
}}

\item{B_cal}{Number of simulated trials per Type-I evaluation.}

\item{lower, upper}{Initial bracketing interval for \code{gamma}, values in \verb{(0,1)}.}

\item{n_draws}{Posterior Monte Carlo draws per trial.}

\item{tol}{Absolute tolerance for \verb{|TypeI - alpha|}. If \code{NULL}, a Monte
Carlo–driven default is used.}

\item{maxit}{Maximum number of bisection iterations.}

\item{seed}{RNG seed for generating common random numbers across thresholds.}

\item{show_progress}{Show a progress bar inside Type-I evaluations.}

\item{verbose}{Print bracketing/iteration messages.}

\item{digits}{Rounding used in cache keys (affects only speed).}

\item{progress_fun}{Optional function called once per bisection iteration:
\code{progress_fun(iter, maxit)}. In Shiny, pass a wrapper that calls
\code{incProgress(1/maxit, detail = sprintf("Iteration \%d of \%d", iter, maxit))}.}
}
\value{
A list with:
\itemize{
\item \code{gamma}: calibrated posterior threshold
\item \code{type1}: estimated Type-I error at \code{gamma}
\item \code{mc_se}: Monte Carlo standard error at \code{gamma}
\item \code{mc_ci}: approximate 95\% MC confidence interval at \code{gamma}
\item \code{bracket}: final bracketing interval
\item \code{iters}: number of bisection iterations used
\item \code{B_cal}, \code{alpha}: echoed inputs
\item \code{trace}: data frame with the search history (gamma tried and type-I estimates)
\item \code{seeds}: vector of seeds actually used (from the final evaluation)
\item \code{settings}: echo of key inputs (design, prior, simulation controls)
}
}
\description{
Finds the posterior probability cutoff \eqn{\gamma} such that the Bayesian
decision rule \code{Pr(theta_t - theta_c > M | data) >= gamma} achieves a
target Type-I error \code{alpha} under the least-favourable null, using
conjugate Beta–Binomial updates (no MCMC). A bisection search is performed
over \code{[lower, upper]} with caching and common random numbers.
}
\examples{
\donttest{
cal <- bcts_calibrate_betaBinom_conj(
  alpha = 0.10, p_c = 0.85, M = -0.20, n_c = 29, n_t = 29,
  prior = "flat", B_cal = 1000, n_draws = 1000, seed = 11
)
cal$gamma
cal$type1
cal$mc_ci
}

}
\seealso{
\code{\link[=bcts_type1_betaBinom_conj]{bcts_type1_betaBinom_conj()}}, \code{\link[=bcts_power_betaBinom_conj]{bcts_power_betaBinom_conj()}}
}
\concept{beta-binomial simulation}
